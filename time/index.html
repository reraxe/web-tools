<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Global Time Converter - NY Base</title>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <style>
    :root{
      --bg:#0f1220; --panel:#171a2b; --panel-2:#1f2440; --txt:#e9ecf2; --muted:#b2b8cc;
      --accent:#6f7dff; --accent-2:#29d3a1; --danger:#ff6b6b; --ring:#3343ff55; --radius:14px;
      --select-bg:#0e1020; --select-hover:#2a3163; --select-border:#ffffff22;
    }
    *{box-sizing:border-box}
    html{color-scheme:dark}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:radial-gradient(1200px 800px at 70% -10%,#2b2f55 0%,transparent 60%),var(--bg);
      color:var(--txt);
    }
    .wrap{max-width:1100px;margin:32px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .title{font-size:clamp(22px,2.6vw,36px);font-weight:800}
    .panel{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid #ffffff10;border-radius:var(--radius);padding:18px}
    .grid{display:grid;gap:14px}
    @media(min-width:900px){.grid-2{grid-template-columns:1.2fr 1fr}}
    .field{display:flex;align-items:center;background:var(--select-bg);border:1px solid var(--select-border);padding:10px 12px;border-radius:10px}
    .field:focus-within{border-color:#ffffff33;box-shadow:0 0 0 5px var(--ring)}
    .field input,.field select{background:transparent;border:none;outline:none;color:var(--txt);width:100%;font-size:15px;appearance:none}
    select{color:var(--txt);background-color:var(--select-bg)}
    select option{background-color:var(--select-bg);color:var(--txt)}
    select option:hover{background-color:var(--select-hover);color:#fff}
    .controls{display:flex;gap:10px;flex-wrap:wrap}
    .btn{background:linear-gradient(180deg,#2a3163,#232a55);color:#fff;border:none;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
    .swap{display:flex;align-items:center;justify-content:center;width:42px;height:42px;border-radius:10px;border:1px dashed #ffffff25;background:#0e1020;color:#9aa3ff;cursor:pointer}
    .result{display:flex;align-items:center;justify-content:space-between;gap:10px;background:#0a0d1a;border:1px solid #ffffff10;border-radius:12px;padding:14px 16px;font-size:16px}
    .cards{display:grid;gap:12px;margin-top:12px}
    @media(min-width:800px){.cards{grid-template-columns:repeat(3,1fr)}}
    .card{background:#0d1122;border:1px solid #ffffff12;padding:14px;border-radius:12px;position:relative;transition:transform .15s}
    .card:hover{transform:translateY(-2px)}
    .remove{position:absolute;right:10px;top:10px;background:#221018;color:#ffc1c1;border:none;border-radius:50%;width:22px;height:22px;line-height:20px;text-align:center;cursor:pointer;font-size:14px;font-weight:700}
    .remove:hover{background:#3c1a24;color:#fff;transform:scale(1.08)}
    .help{font-size:13px;color:var(--muted)}
    .row{display:flex;align-items:center;gap:8px;margin-top:10px}
    .pill{display:inline-block;padding:2px 8px;border:1px solid #ffffff22;border-radius:999px;background:#0e1020;font-size:12px;color:#c9ceef;margin-left:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">üåç Global Time Converter (Base: New York)</div>
    </header>

    <div class="grid grid-2">
      <section class="panel">
        <label>Date</label>
        <div class="field"><input id="dateInput" type="date"></div>
        <label style="margin-top:8px">Time</label>
        <div class="field"><input id="timeInput" type="time" step="60"></div>

        <label style="margin-top:12px">From timezone</label>
        <div class="field"><select id="fromTz"></select></div>
        <label style="margin-top:8px">To timezone</label>
        <div class="field"><select id="toTz"></select></div>

        <!-- Military time toggle (default OFF) -->
        <div class="row">
          <input id="milToggle" type="checkbox" />
          <label for="milToggle">Military (24-hour) time</label>
          <span class="pill">DST auto (EST/EDT shown)</span>
        </div>
        <div class="help">DST follows real-world rules automatically. Abbreviations and offsets update with your selected date.</div>

        <div class="controls" style="margin-top:12px">
          <button id="nowBtn" class="btn" type="button">Now</button>
          <button id="swapBtn" class="swap" type="button">‚áÑ</button>
          <button id="convertBtn" class="btn" type="button">Convert</button>
        </div>

        <div id="result" class="result" style="margin-top:14px">
          <div>
            <div class="help">Converted time</div>
            <time id="outTime"></time>
          </div>
          <div class="help" id="outMeta"></div>
        </div>
      </section>

      <section class="panel">
        <label for="addTz">Add a timezone</label>
        <div class="field">
          <select id="addTz">
            <option value="">‚Äî Add a timezone ‚Äî</option>
          </select>
        </div>
        <div class="help">Dropdown shows current DST/STD abbreviation. Click ‚úï on a card to remove it. Cards auto-update.</div>
        <div id="cards" class="cards"></div>
      </section>
    </div>
  </div>

<script>
const { DateTime } = luxon;
const els = {
  date:document.getElementById('dateInput'),
  time:document.getElementById('timeInput'),
  from:document.getElementById('fromTz'),
  to:document.getElementById('toTz'),
  now:document.getElementById('nowBtn'),
  swap:document.getElementById('swapBtn'),
  convert:document.getElementById('convertBtn'),
  add:document.getElementById('addTz'),
  cards:document.getElementById('cards'),
  outTime:document.getElementById('outTime'),
  outMeta:document.getElementById('outMeta'),
  mil:document.getElementById('milToggle')
};

// Fallback zones (include Tokyo; Houston is mapped to America/Chicago)
const fallbackZones=[
  "UTC","America/New_York","America/Chicago","America/Los_Angeles",
  "Europe/London","Europe/Paris","Europe/Brussels","Europe/Berlin",
  "Asia/Hong_Kong","Asia/Tokyo"
];
let zones=[];
try{zones=Intl.supportedValuesOf?Intl.supportedValuesOf('timeZone'):fallbackZones;}catch{zones=fallbackZones;}

// Aliases for nicer labels in the Add dropdown
const addAliases = {
  "America/Chicago":"America/Chicago ‚Ä¢ Houston",
  "Asia/Tokyo":"Asia/Tokyo ‚Ä¢ Tokyo"
};

function offsetLabelFromMinutes(o){
  const s=o>=0?'+':'-'; const a=Math.abs(o);
  const h=String(Math.trunc(a/60)).padStart(2,'0');
  const m=String(a%60).padStart(2,'0');
  return `GMT${s}${h}:${m}`;
}
function offsetLabel(z){try{const n=DateTime.now().setZone(z);return offsetLabelFromMinutes(n.offset);}catch{return'';}}

// Try to show zone abbreviation (EST/EDT, CET/CEST, JST, etc.). Fallback to GMT offset.
function abbrOrOffset(z, instant){
  try{
    const dt = instant.setZone(z);
    const abbr = dt.offsetNameShort || '';
    return abbr || offsetLabelFromMinutes(dt.offset);
  }catch{return '';}
}

// Populate FROM/TO (stable GMT offsets)
function populateBasic(sel){
  const list=zones.map(z=>({z,off:DateTime.now().setZone(z).offset})).sort((a,b)=>a.off-b.off);
  sel.innerHTML='';
  list.forEach(({z})=>{
    const o=document.createElement('option');
    o.value=z; o.textContent=`${z} (${offsetLabel(z)})`;
    sel.appendChild(o);
  });
}

// Populate ADD dropdown (with DT/ST abbreviations)
function populateAdd(sel){
  const now = DateTime.now();
  const list = zones.map(z=>{
    const dt = now.setZone(z);
    const offStr = offsetLabelFromMinutes(dt.offset);
    const abbr = dt.offsetNameShort || '';
    const base = addAliases[z] || z;
    return { z, off: dt.offset, label: `${base} (${offStr}${abbr ? ' ‚Ä¢ ' + abbr : ''})` };
  }).sort((a,b)=>a.off-b.off);

  sel.innerHTML='';
  list.forEach(({z,label})=>{
    const o=document.createElement('option');
    o.value=z; o.textContent=label;
    sel.appendChild(o);
  });

  // Ensure a dedicated "Houston" entry exists pointing to America/Chicago
  // (even if America/Chicago is already in the list with a generic label)
  const nowChi = now.setZone("America/Chicago");
  const houLabel = `America/Chicago ‚Ä¢ Houston (${offsetLabelFromMinutes(nowChi.offset)}${nowChi.offsetNameShort ? ' ‚Ä¢ ' + nowChi.offsetNameShort : ''})`;
  const houstonOption = document.createElement('option');
  houstonOption.value = "America/Chicago";
  houstonOption.textContent = houLabel;
  sel.appendChild(houstonOption);
}

populateBasic(els.from);
populateBasic(els.to);
populateAdd(els.add);

// Default selected cards (Tokyo included)
const selected=new Set([
  "Europe/Brussels","Europe/London","Europe/Paris","Europe/Berlin",
  "Asia/Hong_Kong","Asia/Tokyo",
  "America/Los_Angeles","America/Chicago"
]);

// Defaults (overridden by localStorage if present)
els.from.value = "America/New_York";
els.to.value = "UTC";

// Military time toggle state (default OFF => 12-hour)
let milOn = false;

function timePattern(){ return milOn ? "HH:mm" : "h:mm a"; }
function fmt(){ return `ccc, LLL d, yyyy ‚Ä¢ ${timePattern()}`; }
function fmtShort(){ return timePattern(); }

function convert(){
  const d=els.date.value||DateTime.now().toFormat('yyyy-LL-dd');
  const t=els.time.value||'00:00';
  const [Y,M,D]=d.split('-').map(Number);
  const [H,Mi]=t.split(':').map(Number);

  // interpret wall time in FROM zone (DST auto)
  const src = DateTime.fromObject({year:Y,month:M,day:D,hour:H,minute:Mi},{zone:els.from.value});
  const dst = src.setZone(els.to.value);

  els.outTime.textContent=dst.toFormat(fmt());

  const fromTag = abbrOrOffset(els.from.value, src);
  const toTag = abbrOrOffset(els.to.value, src);
  const toGmt = offsetLabelFromMinutes(dst.offset);
  els.outMeta.textContent = `${els.from.value} (${fromTag}) ‚Üí ${els.to.value} (${toTag}, ${toGmt})`;

  updateCards(src);
}

function setNow(){
  const now=DateTime.now().setZone(els.from.value);
  els.date.value=now.toFormat('yyyy-LL-dd');
  els.time.value=now.toFormat('HH:mm');
  convert();
}
function swap(){
  const a=els.from.value,b=els.to.value;els.from.value=b;els.to.value=a;convert();
}

function updateCards(baseInstant){
  els.cards.innerHTML='';
  selected.forEach(z=>{
    const t = baseInstant.setZone(z);
    const div=document.createElement('div');
    div.className='card';
    const tag = abbrOrOffset(z, baseInstant);
    div.innerHTML=`<button class="remove" data-z="${z}">√ó</button>
      <h4>${z}</h4>
      <div class="big">${t.toFormat(fmtShort())}</div>
      <div class="help">${t.toFormat('ccc, LLL d, yyyy')} (${tag}, ${offsetLabelFromMinutes(t.offset)})</div>`;
    els.cards.appendChild(div);
  });
  localStorage.setItem('gtc-defaults',JSON.stringify({
    from:els.from.value,to:els.to.value,zones:[...selected],mil:milOn
  }));
}

els.cards.addEventListener('click',e=>{
  if(e.target.matches('.remove')){
    selected.delete(e.target.dataset.z);
    convert();
  }
});
els.add.addEventListener('change',e=>{
  const z=e.target.value;
  if(z&&!selected.has(z)){selected.add(z);convert();}
  e.target.value='';
});

els.now.addEventListener('click',setNow);
els.convert.addEventListener('click',convert);
els.swap.addEventListener('click',swap);
els.from.addEventListener('change',()=>{setNow();});
els.to.addEventListener('change',convert);

// Military toggle listener
els.mil.addEventListener('change',()=>{ milOn = els.mil.checked; convert(); });

// Restore saved prefs
const saved=JSON.parse(localStorage.getItem('gtc-defaults')||'{}');
if(saved.from){ els.from.value=saved.from; } else { els.from.value="America/New_York"; }
if(saved.to){ els.to.value=saved.to; } else { els.to.value="UTC"; }
if(saved.zones){ saved.zones.forEach(z=>selected.add(z)); }
if(typeof saved.mil === 'boolean'){ milOn = saved.mil; els.mil.checked = milOn; }

setNow();
</script>
</body>
</html>
